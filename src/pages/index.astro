---
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import Featured from '../components/featured/Featured.astro';
import Notification from '../components/Notification.astro';
import RecentPosts from '../components/RecentPosts.astro';
import { getAllPosts } from '../utils/getPosts';

const allPosts = await getAllPosts();
const sortedPosts = allPosts.sort((a, b) => {
  return new Date(b.data.date).getTime() - new Date(a.data.date).getTime();
});

const topPickPosts = sortedPosts.filter(post => post.data.topPick);
const trendingPosts = sortedPosts.filter(post => post.data.trending);
const popularPosts = sortedPosts.filter(post => post.data.popular);

const recentPosts = sortedPosts.slice(0, 3);

const siteMetadata = {
  title: 'Revista',
  description: 'Revista is an open source blog/magazine template. Simply write articles in Markdown, place in the content folder, and Revista will automatically create categories and articles!',
  url: import.meta.env.SITE || 'https://yourdomain.com',
  image: '/logo.png',
};
---

<BaseLayout 
  title={`${siteMetadata.title} | Promoting Free Education for Everyone`}
  description={siteMetadata.description}
>
  <Hero />
  <Featured 
    topPickPosts={topPickPosts}
    trendingPosts={trendingPosts}
    popularPosts={popularPosts}
  />
  <Notification />
  <RecentPosts posts={recentPosts} />
</BaseLayout>
