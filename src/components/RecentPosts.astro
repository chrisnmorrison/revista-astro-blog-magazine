---
import SidebarWide from './Sidebar/SidebarWide.astro';
import { getColor } from '../utils/heroCategories';
import { resolveImagePath } from '../utils/imagePath';
import { normalizePostData, getCategoryUrl } from '../utils/postHelpers';
import { formatDateLong } from '../utils/formatDate';
import type { Post } from '../utils/getPosts';

interface Props {
  posts?: Post[];
}

const { posts = [] } = Astro.props;
---

<section class="container">
  <div class="row">
    <div class="col-lg-8 col-12">
      <h2 class="section-title">Recent Articles</h2>

      {posts.map(post => {
        const normalized = normalizePostData(post);
        const imageSrc = resolveImagePath(post.data.image);
        const categoryColor = getColor(post.data.category);

        return (
          <article
            key={post.id}
            class="card card-bg card-shadow recent-article-mb"
          >
            <a href={normalized.url}>
              {imageSrc && (
                <img
                  src={imageSrc}
                  alt={normalized.title}
                  class="img"
                  style="width: 100%; height: auto;"
                />
              )}
            </a>

            <div class="card-body">
              <a href={normalized.url}>
                <h3 class="recent-articles-heading">{normalized.title}</h3>
              </a>

              <ul class="card-meta list-inline">
                <li class="list-inline-item">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                  </svg>
                  {normalized.readingTime} Min Read
                </li>
                <li class="list-inline-item">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                  </svg>
                  {normalized.dateLong}
                </li>
                <li class="list-inline-item">
                  <a
                    href={normalized.categoryUrl}
                    class="category-link"
                    style={`color: ${categoryColor}; background-color: ${categoryColor};`}
                  >
                    <div class="category-text-color">
                      {normalized.category}
                    </div>
                  </a>
                </li>
              </ul>
              <a href={normalized.url}>
                <p class="excerpt">{normalized.excerpt}</p>
              </a>
              <a class="btn btn-outline-primary" href={normalized.url}>
                Read More
              </a>
            </div>
          </article>
        );
      })}
    </div>
    <SidebarWide />
  </div>
</section>
